#cloud-config
autoinstall:
  version: 1
  early-commands:
  - systemctl stop ssh # otherwise packer tries to connect and exceed max attempts
  locale: de_DE.UTF-8
  keyboard:
    layout: de
    variant: de
  storage:
    layout:
      name: direct
  identity:
    hostname: ubuntu
    username: packer
    password: "AkwAM23UR69fwmXfRtR.9KnImYeu09uPp4WS6c/HEGkJKN.jToje8KN88bEOBEAlS.NdDf3HyJdNxaFjXJb9C1" # packer (generated with 'mkpasswd -m sha-512')
  ssh:
    install-server: yes
#       authorized-keys:
#         - $key
    allow-pw: yes
  packages:
  - ansible
  user-data:
    disable_root: true
  late-commands:
  - echo 'packer ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/ubuntu